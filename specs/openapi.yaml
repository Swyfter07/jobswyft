openapi: 3.0.3
info:
  title: Jobswyft API
  version: 1.0.0
  description: AI-powered job application assistant API

servers:
  - url: http://localhost:3001
    description: Local development
  - url: https://api.jobswyft.com
    description: Production

paths:
  /health:
    get:
      summary: Health check
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /v1/auth/login:
    post:
      summary: Initiate OAuth login
      operationId: authLogin
      responses:
        '200':
          description: OAuth URL returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'

  /v1/auth/callback:
    get:
      summary: Handle OAuth callback
      operationId: authCallback
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: true
          description: The authorization code returned by the provider
      responses:
        '200':
          description: Session tokens returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'

  /v1/auth/logout:
    post:
      summary: Logout user
      operationId: authLogout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /v1/auth/me:
    get:
      summary: Get current user profile
      operationId: getProfile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile data returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/auth/account:
    delete:
      summary: Delete user account
      operationId: deleteAccount
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Account deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDeletedResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/resumes:
    get:
      summary: List user's resumes
      operationId: listResumes
      tags:
        - Resumes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Paginated list of resumes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResumeListResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Upload and parse a resume
      operationId: uploadResume
      tags:
        - Resumes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: PDF file (max 10MB)
              required:
                - file
      responses:
        '200':
          description: Resume uploaded and parsed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResumeUploadResponse'
        '400':
          description: Validation error (not PDF or over 10MB)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Credit exhausted or resume limit reached
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/resumes/{resume_id}:
    get:
      summary: Get resume details with download URL
      operationId: getResume
      tags:
        - Resumes
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: resume_id
          schema:
            type: string
            format: uuid
          required: true
          description: Resume UUID
      responses:
        '200':
          description: Resume details with signed download URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResumeDetailResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Resume not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete a resume
      operationId: deleteResume
      tags:
        - Resumes
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: resume_id
          schema:
            type: string
            format: uuid
          required: true
          description: Resume UUID
      responses:
        '200':
          description: Resume deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResumeDeleteResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Resume not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/resumes/{resume_id}/active:
    put:
      summary: Set resume as active
      operationId: setActiveResume
      tags:
        - Resumes
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: resume_id
          schema:
            type: string
            format: uuid
          required: true
          description: Resume UUID to set as active
      responses:
        '200':
          description: Resume set as active
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SetActiveResumeResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Resume not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/jobs:
    post:
      summary: Create a new job record
      description: |
        Creates a new job record with optional status. Use this endpoint when manually saving
        a job as "applied" or with a specific status. Defaults to "saved" if no status provided.
      operationId: createJob
      tags:
        - Jobs
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobCreateRequest'
            examples:
              withAppliedStatus:
                summary: Save job as applied
                value:
                  title: "Senior Software Engineer"
                  company: "Acme Corp"
                  description: "We are looking for..."
                  source_url: "https://acme.com/jobs/123"
                  status: "applied"
              withDefaultStatus:
                summary: Save job (default status)
                value:
                  title: "Backend Developer"
                  company: "TechCo"
                  description: "Join our team..."
      responses:
        '201':
          description: Job created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '400':
          description: Validation error (missing required fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      summary: List tracked jobs with pagination
      description: |
        Returns a paginated list of tracked jobs with optional filtering by status.
        Includes a notes preview (first 100 characters) for each job.
      operationId: listJobs
      tags:
        - Jobs
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/JobStatus'
          description: Filter by job status
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: page_size
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Items per page
        - in: query
          name: sort
          schema:
            type: string
            default: updated_at
          description: Field to sort by
      responses:
        '200':
          description: Paginated list of jobs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobListResponse'
              example:
                success: true
                data:
                  items:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      title: "Senior Software Engineer"
                      company: "Acme Corp"
                      status: "applied"
                      notes_preview: "Recruiter mentioned..."
                      created_at: "2026-01-30T12:00:00Z"
                      updated_at: "2026-01-30T14:00:00Z"
                  total: 25
                  page: 1
                  page_size: 20
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/jobs/scan:
    post:
      summary: Save scanned job from extension
      operationId: createScannedJob
      tags:
        - Jobs
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobCreateRequest'
      responses:
        '201':
          description: Job created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '400':
          description: Validation error (missing required fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/jobs/{job_id}:
    get:
      summary: Get job details
      operationId: getJob
      tags:
        - Jobs
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: job_id
          schema:
            type: string
            format: uuid
          required: true
          description: Job UUID
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update job fields
      operationId: updateJob
      tags:
        - Jobs
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: job_id
          schema:
            type: string
            format: uuid
          required: true
          description: Job UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobUpdateRequest'
      responses:
        '200':
          description: Job updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete a job
      operationId: deleteJob
      tags:
        - Jobs
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: job_id
          schema:
            type: string
            format: uuid
          required: true
          description: Job UUID
      responses:
        '200':
          description: Job deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobDeleteResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/jobs/{job_id}/status:
    put:
      summary: Update job status
      description: |
        Updates only the job status field. Valid statuses are:
        saved, applied, interviewing, offered, rejected, accepted
      operationId: updateJobStatus
      tags:
        - Jobs
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: job_id
          schema:
            type: string
            format: uuid
          required: true
          description: Job UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobStatusUpdateRequest'
            example:
              status: "interviewing"
      responses:
        '200':
          description: Job status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '400':
          description: Invalid status value
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "Invalid status. Allowed: saved, applied, interviewing, offered, rejected, accepted"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/jobs/{job_id}/notes:
    put:
      summary: Update job notes
      description: |
        Adds or updates notes on a job. Notes are replaced entirely (not appended).
      operationId: updateJobNotes
      tags:
        - Jobs
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: job_id
          schema:
            type: string
            format: uuid
          required: true
          description: Job UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobNotesUpdateRequest'
            example:
              notes: "Recruiter mentioned team is scaling. Follow up next week."
      responses:
        '200':
          description: Job notes updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/autofill/data:
    get:
      summary: Get autofill data for form completion
      description: |
        Retrieves user's personal information and resume data structured for form autofill.

        **Data Sources (Priority Order):**
        1. Resume `parsed_data.contact` fields (highest priority)
        2. Profile table fields (fallback)
        3. Null for missing fields

        **Response includes:**
        - Personal data: first_name, last_name, full_name, email, phone, location, linkedin_url
        - Resume: id, file_name, signed download_url (1 hour expiry), parsed_summary
        - Placeholders for future features: work_authorization, salary_expectation

        **Performance:** Response completes within 1 second (NFR4).
      operationId: getAutofillData
      tags:
        - Autofill
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Autofill data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutofillDataResponse'
              examples:
                withActiveResume:
                  summary: With active resume
                  value:
                    success: true
                    data:
                      personal:
                        first_name: "John"
                        last_name: "Doe"
                        full_name: "John Doe"
                        email: "john@example.com"
                        phone: "+1-555-0100"
                        location: "San Francisco, CA"
                        linkedin_url: "https://linkedin.com/in/johndoe"
                        portfolio_url: null
                      resume:
                        id: "550e8400-e29b-41d4-a716-446655440000"
                        file_name: "john_doe_resume.pdf"
                        download_url: "https://supabase.../signed-url"
                        parsed_summary: "Senior software engineer with 8 years..."
                      work_authorization: null
                      salary_expectation: null
                withoutResume:
                  summary: No active resume
                  value:
                    success: true
                    data:
                      personal:
                        first_name: "John"
                        last_name: "Doe"
                        full_name: "John Doe"
                        email: "john@example.com"
                        phone: null
                        location: null
                        linkedin_url: null
                        portfolio_url: null
                      resume: null
                      work_authorization: null
                      salary_expectation: null
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "AUTH_REQUIRED"
                  message: "Authentication required"

  /v1/usage:
    get:
      summary: Get current usage balance
      description: |
        Returns the user's current credit balance and usage breakdown by operation type.

        **Period Types:**
        - `lifetime`: Free tier users have a fixed 5 credits that never reset
        - `monthly`: Paid tier users have monthly credits that reset on the 1st

        **Unlimited Tier:**
        - When `credits_limit` is -1, the user has unlimited credits
        - `credits_remaining` will also be -1 for unlimited users

        **Usage Tracking:**
        - Credits are consumed by AI operations (match, cover_letter, answer, outreach, resume_parse)
        - Referral bonuses add credits (shown as negative `credits_used` in history)
      operationId: getUsage
      tags:
        - Usage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Usage balance retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageBalanceResponse'
              example:
                success: true
                data:
                  subscription_tier: "free"
                  period_type: "lifetime"
                  period_key: "lifetime"
                  credits_used: 3
                  credits_limit: 5
                  credits_remaining: 2
                  usage_by_type:
                    match: 1
                    cover_letter: 2
                    answer: 0
                    outreach: 0
                    resume_parse: 0
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/subscriptions/checkout:
    post:
      summary: Create checkout session
      description: |
        Create a Stripe Checkout session for subscription upgrade.
        In mock mode, immediately upgrades user's tier.

        **Valid Tiers:**
        - `starter`: $4.99/mo - maps to 100 credits/month
        - `pro`: $9.99/mo - maps to 100 credits/month
        - `power`: $19.99/mo - maps to unlimited credits
      operationId: createCheckoutSession
      tags:
        - Subscriptions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
            example:
              tier: "pro"
              success_url: "https://app.jobswyft.com/account?success=true"
              cancel_url: "https://app.jobswyft.com/account?canceled=true"
      responses:
        '200':
          description: Checkout session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckoutResponse'
              example:
                success: true
                data:
                  checkout_url: "mock://checkout?tier=pro"
                  mock: true
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/subscriptions/portal:
    post:
      summary: Create portal session
      description: |
        Create a Stripe Customer Portal session for subscription management.
        In mock mode, returns mock portal URL.
      operationId: createPortalSession
      tags:
        - Subscriptions
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Portal session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PortalResponse'
              example:
                success: true
                data:
                  portal_url: "mock://portal"
                  mock: true
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/subscriptions/mock-cancel:
    post:
      summary: Mock cancel subscription
      description: |
        Mock cancellation endpoint (dev/test only).
        Downgrades user to free tier. Only available when STRIPE_MOCK_MODE=true.
      operationId: mockCancelSubscription
      tags:
        - Subscriptions
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Subscription canceled (mock)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                data:
                  message: "Subscription canceled (mock)"
                  tier: "free"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Mock mode disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "MOCK_MODE_DISABLED"
                  message: "Mock endpoint only available when STRIPE_MOCK_MODE=true"

  /v1/webhooks/stripe:
    post:
      summary: Stripe webhook handler
      description: |
        Receives Stripe webhook events. In mock mode, this is a no-op stub.

        **Post-MVP Implementation Notes:**
        1. Verify signature with stripe.Webhook.construct_event()
        2. Handle subscription events (created, updated, deleted)
        3. Handle invoice.payment_failed
        4. Process events idempotently
      operationId: stripeWebhook
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                type: object
                properties:
                  received:
                    type: boolean
                  status:
                    type: string
              example:
                received: true
                status: "ignored"

  /v1/usage/history:
    get:
      summary: Get usage history
      description: |
        Returns a paginated list of usage events for the authenticated user.
        Events are ordered by creation date (newest first).

        **Event Types:**
        - Positive `credits_used`: AI operation that consumed credits
        - Negative `credits_used`: Referral bonus that added credits
      operationId: getUsageHistory
      tags:
        - Usage
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Items per page
      responses:
        '200':
          description: Usage history retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageHistoryResponse'
              example:
                success: true
                data:
                  items:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      operation_type: "cover_letter"
                      ai_provider: "claude"
                      credits_used: 1
                      period_type: "lifetime"
                      period_key: "lifetime"
                      created_at: "2026-02-01T10:00:00Z"
                  total: 15
                  page: 1
                  page_size: 20
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ============================================================================
  # Privacy Endpoints
  # ============================================================================

  /v1/privacy/data-summary:
    get:
      summary: Get data summary
      description: |
        Returns a comprehensive summary of all data stored for the authenticated user.
        Includes information about stored data types, counts, and data retention policies.

        **Data Categories:**
        - Profile information (email, name, preferences)
        - Resumes (files and parsed data)
        - Jobs (applications and status)
        - Usage history (operation logs)
        - AI-generated content (never stored)

        **GDPR/Privacy Notes:**
        - Data export feature planned for future update
        - All AI outputs are ephemeral and never stored
      operationId: getDataSummary
      tags:
        - Privacy
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Data summary retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataSummaryResponse'
              example:
                success: true
                data:
                  profile:
                    stored: true
                    fields: ["email", "full_name", "subscription_tier", "preferences"]
                    location: "Supabase PostgreSQL (encrypted at rest)"
                  resumes:
                    count: 3
                    max_resumes: 5
                    at_limit: false
                    storage: "Supabase Storage (encrypted)"
                    includes: ["PDF files", "parsed text data"]
                  jobs:
                    count: 25
                    storage: "Supabase PostgreSQL"
                    status_breakdown:
                      applied: 15
                      interviewing: 6
                      offered: 2
                      rejected: 2
                  usage_history:
                    count: 47
                    storage: "Supabase PostgreSQL"
                    includes: ["operation type", "timestamp", "no content stored"]
                    breakdown:
                      match: 12
                      cover_letter: 18
                      answer: 10
                      outreach: 5
                      resume_parse: 2
                  ai_generated_content:
                    stored: false
                    note: "AI outputs are never saved to our servers"
                  data_retention: "Data retained until you delete your account"
                  export_available: false
                  export_note: "Data export feature coming in future update (GDPR compliance)"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/privacy/delete-request:
    post:
      summary: Request account deletion
      description: |
        Initiates the account deletion process by generating a confirmation token
        and sending it to the user's email address.

        **Process:**
        1. Token generated and sent to user's email
        2. Token valid for 24 hours
        3. Account remains active until deletion is confirmed
        4. User can cancel by not confirming or calling cancel-delete

        **MVP Note:** Email is currently logged to console for testing.
        Full email integration planned for post-MVP.
      operationId: requestDeletion
      tags:
        - Privacy
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteRequestRequest'
            example:
              reason: "no_longer_needed"
      responses:
        '200':
          description: Deletion request initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteRequestResponse'
              example:
                success: true
                data:
                  message: "Confirmation email sent. Please check your inbox."
                  email_sent_to: "j***@example.com"
                  expires_in: "24 hours"
                  deletion_initiated_at: "2026-02-01T12:00:00Z"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/privacy/confirm-delete:
    post:
      summary: Confirm account deletion
      description: |
        Confirms account deletion using the token sent via email.

        **No Authentication Required:** The token itself serves as proof of identity
        (it was sent to the user's verified email).

        **Permanently Deletes:**
        - Profile record
        - All resumes (database records + storage files)
        - All jobs
        - All usage events
        - All feedback records
        - Supabase auth user

        **WARNING:** This action is irreversible.
      operationId: confirmDeletion
      tags:
        - Privacy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmDeleteRequest'
            example:
              token: "abc123def456..."
      responses:
        '200':
          description: Account deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfirmDeleteResponse'
              example:
                success: true
                data:
                  message: "Your account and all data have been permanently deleted."
                  deleted_at: "2026-02-01T12:30:00Z"
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "INVALID_TOKEN"
                  message: "Invalid or expired deletion token. Please request again."

  /v1/privacy/cancel-delete:
    post:
      summary: Cancel pending deletion
      description: |
        Cancels a pending account deletion request.
        Clears the deletion token, allowing the account to remain active indefinitely.
      operationId: cancelDeletion
      tags:
        - Privacy
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Deletion cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelDeleteResponse'
              example:
                success: true
                data:
                  message: "Pending deletion has been cancelled. Your account remains active."
                  cancelled_at: "2026-02-01T13:00:00Z"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No pending deletion found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "No pending deletion request found."

  /v1/feedback:
    post:
      summary: Submit user feedback
      description: |
        Submit feedback about the product. Category defaults to 'general' if not specified.
        Context is optional and can include page_url, feature_used, browser, extension_version.

        **Categories:**
        - `bug`: Report a bug or issue
        - `feature_request`: Suggest a new feature
        - `general`: General feedback (default)
        - `praise`: Positive feedback
        - `complaint`: Negative feedback or concern

        **Context Fields (optional):**
        - `page_url`: URL where feedback was submitted from
        - `feature_used`: Feature being used when providing feedback
        - `browser`: User's browser
        - `extension_version`: Chrome extension version
        - `screen_size`: User's screen resolution

        **Note:** Unknown context fields are silently stripped for security.
      operationId: submitFeedback
      tags:
        - Feedback
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackRequest'
            examples:
              featureRequest:
                summary: Feature request with context
                value:
                  content: "The cover letter generation is amazing! Would love to see more tone options."
                  category: "feature_request"
                  context:
                    page_url: "https://linkedin.com/jobs/123"
                    feature_used: "cover_letter"
                    browser: "Chrome 120"
              bugReport:
                summary: Bug report
                value:
                  content: "The button doesn't work when clicked twice quickly."
                  category: "bug"
              simpleGeneral:
                summary: Simple general feedback
                value:
                  content: "Great product! I really enjoy using it for my job search."
      responses:
        '200':
          description: Feedback submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeedbackSubmitResponse'
              example:
                success: true
                data:
                  message: "Thank you for your feedback!"
                  feedback_id: "550e8400-e29b-41d4-a716-446655440000"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                contentTooShort:
                  summary: Content too short
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Feedback content must be at least 10 characters"
                contentTooLong:
                  summary: Content too long
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Feedback content must not exceed 5000 characters"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "AUTH_REQUIRED"
                  message: "Authentication required"

  /v1/ai/match:
    post:
      summary: Generate AI match analysis
      description: |
        Analyzes how well a resume matches a job posting using AI.
        Returns a match score, strengths, gaps, and recommendations.

        **Provider Resolution Order:**
        1. `ai_provider` in request (highest priority)
        2. User's `preferred_ai_provider` from profile
        3. System default: Claude

        **Fallback:** If primary provider fails, automatically falls back to secondary.
      operationId: generateMatchAnalysis
      tags:
        - AI
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MatchAnalysisRequest'
            examples:
              withActiveResume:
                summary: Using active resume
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
              withSpecificResume:
                summary: Using specific resume
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  resume_id: "660e8400-e29b-41d4-a716-446655440001"
                  ai_provider: "gpt"
      responses:
        '200':
          description: Match analysis generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchAnalysisResponse'
              example:
                success: true
                data:
                  match_score: 78
                  strengths:
                    - "5+ years Python experience matches requirement"
                    - "FastAPI experience directly applicable"
                    - "Strong backend development background"
                  gaps:
                    - "Job requires Kubernetes experience - not mentioned in resume"
                    - "No mention of cloud infrastructure experience"
                  recommendations:
                    - "Highlight Docker experience as transferable to Kubernetes"
                    - "Mention any cloud platform experience in cover letter"
                  ai_provider_used: "claude"
        '400':
          description: Validation error (no resume selected)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "No resume selected. Upload or select a resume first."
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Resume or job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                resumeNotFound:
                  summary: Resume not found
                  value:
                    success: false
                    error:
                      code: "RESUME_NOT_FOUND"
                      message: "Resume not found"
                jobNotFound:
                  summary: Job not found
                  value:
                    success: false
                    error:
                      code: "JOB_NOT_FOUND"
                      message: "Job not found"
        '422':
          description: Credit exhausted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "CREDIT_EXHAUSTED"
                  message: "You've used all your credits. Upgrade to continue."
        '503':
          description: AI provider unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "AI_PROVIDER_UNAVAILABLE"
                  message: "AI service temporarily unavailable. Please try again."

  /v1/ai/cover-letter:
    post:
      summary: Generate AI cover letter
      description: |
        Generates a tailored cover letter based on the user's resume and a job description.
        Supports customizable tone and optional user instructions.

        **Tone Options:**
        - `confident`: Assertive, achievement-focused, uses metrics
        - `friendly`: Warm, personable, authentic
        - `enthusiastic`: Energetic, passionate, shows motivation
        - `professional`: Balanced, formal, traditional (default)
        - `executive`: Strategic, leadership-focused, high-level

        **Provider Resolution Order:**
        1. `ai_provider` in request (highest priority)
        2. User's `preferred_ai_provider` from profile
        3. System default: Claude

        **Fallback:** If primary provider fails, automatically falls back to secondary.

        **Note:** Content is NOT stored on the server. Each generation decrements usage by 1.
      operationId: generateCoverLetter
      tags:
        - AI
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CoverLetterRequest'
            examples:
              basicGeneration:
                summary: Basic generation with default tone
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
              withToneAndInstructions:
                summary: With custom tone and instructions
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  tone: "confident"
                  custom_instructions: "Mention my open-source contributions"
                  ai_provider: "claude"
              regenerateWithFeedback:
                summary: Regenerate with feedback
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  tone: "confident"
                  feedback: "Make it shorter and mention my AWS certification"
                  previous_content: "Dear Hiring Manager,\n\nI am writing to express..."
      responses:
        '200':
          description: Cover letter generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CoverLetterResponse'
              example:
                success: true
                data:
                  content: "Dear Hiring Manager,\n\nI am writing to express my strong interest in the Senior Python Developer position at Acme Corp..."
                  ai_provider_used: "claude"
                  tokens_used: 1250
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidTone:
                  summary: Invalid tone
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Invalid tone. Must be one of: confident, friendly, enthusiastic, professional, executive"
                noResume:
                  summary: No resume selected
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "No resume selected. Upload or select a resume first."
                feedbackWithoutPrevious:
                  summary: Feedback without previous content
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "previous_content required when providing feedback"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Resume or job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                resumeNotFound:
                  summary: Resume not found
                  value:
                    success: false
                    error:
                      code: "RESUME_NOT_FOUND"
                      message: "Resume not found"
                jobNotFound:
                  summary: Job not found
                  value:
                    success: false
                    error:
                      code: "JOB_NOT_FOUND"
                      message: "Job not found"
        '422':
          description: Credit exhausted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "CREDIT_EXHAUSTED"
                  message: "You've used all your credits. Upgrade to continue."
        '503':
          description: AI provider unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "AI_PROVIDER_UNAVAILABLE"
                  message: "AI service temporarily unavailable. Please try again."

  /v1/ai/cover-letter/pdf:
    post:
      summary: Export cover letter as PDF
      description: |
        Converts cover letter text into a professionally formatted PDF document.

        **PDF Formatting:**
        - Standard letter size (8.5" x 11")
        - 1-inch margins on all sides
        - Professional serif font (Times New Roman, 12pt)
        - Proper paragraph spacing
        - Current date at top

        **Note:** This endpoint does NOT count against usage balance.
      operationId: exportCoverLetterPDF
      tags:
        - AI
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CoverLetterPDFRequest'
            example:
              content: "Dear Hiring Manager,\n\nI am writing to express my strong interest..."
              file_name: "cover_letter_acme_corp"
      responses:
        '200':
          description: PDF generated successfully
          content:
            application/pdf:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              schema:
                type: string
              description: Attachment header with filename
              example: 'attachment; filename="cover_letter_acme_corp.pdf"'
        '400':
          description: Validation error (empty content)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "Content cannot be empty"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/ai/answer:
    post:
      summary: Generate AI answer to application question
      description: |
        Generates a tailored answer to an application question based on the user's resume and job description.
        Supports configurable length and optional regeneration with feedback.

        **Length Options:**
        - `150`: Short - Brief, direct response
        - `300`: Medium - Concise with one supporting point
        - `500`: Standard - 2-3 supporting points (default)
        - `1000`: Detailed - With examples and context

        **Provider Resolution Order:**
        1. `ai_provider` in request (highest priority)
        2. User's `preferred_ai_provider` from profile
        3. System default: Claude

        **Fallback:** If primary provider fails, automatically falls back to secondary.

        **Note:** Content is NOT stored on the server. Each generation decrements usage by 1.
      operationId: generateAnswer
      tags:
        - AI
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnswerRequest'
            examples:
              basicGeneration:
                summary: Basic answer generation
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  question: "Why do you want to work at Acme Corp?"
              withLengthOption:
                summary: With specific length
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  question: "Describe a challenging project you've worked on"
                  max_length: 1000
                  ai_provider: "gpt"
              regenerateWithFeedback:
                summary: Regenerate with feedback
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  question: "Why do you want to work at Acme Corp?"
                  feedback: "Make it more specific about the company's recent product launch"
                  previous_content: "I'm drawn to Acme Corp's mission to..."
      responses:
        '200':
          description: Answer generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnswerResponse'
              example:
                success: true
                data:
                  content: "I am drawn to Acme Corp's mission to revolutionize the industry through innovative technology. With my 5 years of experience..."
                  ai_provider_used: "claude"
                  tokens_used: 450
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidMaxLength:
                  summary: Invalid max_length
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Invalid max_length. Must be one of: 150, 300, 500, 1000"
                noResume:
                  summary: No resume selected
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "No resume selected. Upload or select a resume first."
                feedbackWithoutPrevious:
                  summary: Feedback without previous content
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "previous_content required when providing feedback"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Resume or job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                resumeNotFound:
                  summary: Resume not found
                  value:
                    success: false
                    error:
                      code: "RESUME_NOT_FOUND"
                      message: "Resume not found"
                jobNotFound:
                  summary: Job not found
                  value:
                    success: false
                    error:
                      code: "JOB_NOT_FOUND"
                      message: "Job not found"
        '422':
          description: Credit exhausted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "CREDIT_EXHAUSTED"
                  message: "You've used all your credits. Upgrade to continue."
        '503':
          description: AI provider unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "AI_PROVIDER_UNAVAILABLE"
                  message: "AI service temporarily unavailable. Please try again."

  /v1/ai/outreach:
    post:
      summary: Generate AI outreach message
      description: |
        Generates a tailored outreach message for recruiters or hiring managers based on the user's resume and job description.
        Adapts to recipient type and platform constraints.

        **Recipient Types:**
        - `recruiter`: Professional, concise, highlights relevant experience, focuses on fit
        - `hiring_manager`: Technical depth, shows understanding of challenges, demonstrates value
        - `referral`: Warm tone, asks for guidance/introduction

        **Platforms:**
        - `linkedin`: Max 300 characters, punchy and professional
        - `email`: Full email with subject line, 150-300 words
        - `twitter`: Max 280 characters, casual professional

        **Provider Resolution Order:**
        1. `ai_provider` in request (highest priority)
        2. User's `preferred_ai_provider` from profile
        3. System default: Claude

        **Fallback:** If primary provider fails, automatically falls back to secondary.

        **Note:** Content is NOT stored on the server. Each generation decrements usage by 1.
      operationId: generateOutreach
      tags:
        - AI
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OutreachRequest'
            examples:
              linkedinRecruiter:
                summary: LinkedIn message to recruiter
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  recipient_type: "recruiter"
                  platform: "linkedin"
                  recipient_name: "Sarah Chen"
              emailToHiringManager:
                summary: Email to hiring manager
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  recipient_type: "hiring_manager"
                  platform: "email"
                  recipient_name: "John Smith"
                  ai_provider: "gpt"
              regenerateWithFeedback:
                summary: Regenerate with feedback
                value:
                  job_id: "550e8400-e29b-41d4-a716-446655440000"
                  recipient_type: "hiring_manager"
                  platform: "email"
                  feedback: "Make it shorter and mention my cloud migration experience"
                  previous_content: "Dear Ms. Chen,\n\nI am writing to express..."
      responses:
        '200':
          description: Outreach message generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutreachResponse'
              example:
                success: true
                data:
                  content: "Hi Sarah,\n\nI came across the Senior Engineer role at Acme Corp and was impressed by the team's work on scalable infrastructure..."
                  ai_provider_used: "claude"
                  tokens_used: 380
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidRecipientType:
                  summary: Invalid recipient_type
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Invalid recipient_type. Must be one of: recruiter, hiring_manager, referral"
                invalidPlatform:
                  summary: Invalid platform
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Invalid platform. Must be one of: linkedin, email, twitter"
                noResume:
                  summary: No resume selected
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "No resume selected. Upload or select a resume first."
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Resume or job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                resumeNotFound:
                  summary: Resume not found
                  value:
                    success: false
                    error:
                      code: "RESUME_NOT_FOUND"
                      message: "Resume not found"
                jobNotFound:
                  summary: Job not found
                  value:
                    success: false
                    error:
                      code: "JOB_NOT_FOUND"
                      message: "Job not found"
        '422':
          description: Credit exhausted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "CREDIT_EXHAUSTED"
                  message: "You've used all your credits. Upgrade to continue."
        '503':
          description: AI provider unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "AI_PROVIDER_UNAVAILABLE"
                  message: "AI service temporarily unavailable. Please try again."

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: ok
        version:
          type: string
          example: 1.0.0

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: AUTH_REQUIRED
            message:
              type: string
            details:
              type: object

    LoginResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                oauth_url:
                  type: string
                  format: uri

    SessionResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                access_token:
                  type: string
                refresh_token:
                  type: string
                expires_at:
                  type: integer
                user:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    email:
                      type: string
                      format: email

    ProfileResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              required:
                - id
                - email
                - subscription_tier
                - subscription_status
                - preferred_ai_provider
                - created_at
              properties:
                id:
                  type: string
                  format: uuid
                email:
                  type: string
                  format: email
                full_name:
                  type: string
                  nullable: true
                subscription_tier:
                  type: string
                  example: free
                subscription_status:
                  type: string
                  example: active
                active_resume_id:
                  type: string
                  format: uuid
                  nullable: true
                preferred_ai_provider:
                  type: string
                  example: claude
                created_at:
                  type: string
                  format: date-time

    AccountDeletedResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                message:
                  type: string
                  example: Your account and all data have been permanently deleted.

    ResumeListItem:
      type: object
      required:
        - id
        - file_name
        - is_active
        - parse_status
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        file_name:
          type: string
          example: john_doe_resume.pdf
        is_active:
          type: boolean
        parse_status:
          type: string
          enum: [pending, completed, failed]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ResumeListResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/ResumeListItem'
                total:
                  type: integer
                page:
                  type: integer
                page_size:
                  type: integer

    ParsedResumeData:
      type: object
      properties:
        contact:
          type: object
          properties:
            first_name:
              type: string
            last_name:
              type: string
            email:
              type: string
            phone:
              type: string
            location:
              type: string
            linkedin_url:
              type: string
        summary:
          type: string
        experience:
          type: array
          items:
            type: object
            properties:
              title:
                type: string
              company:
                type: string
              start_date:
                type: string
              end_date:
                type: string
              description:
                type: string
        education:
          type: array
          items:
            type: object
            properties:
              degree:
                type: string
              institution:
                type: string
              graduation_year:
                type: string
        skills:
          type: array
          items:
            type: string

    ResumeDetailResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              required:
                - id
                - file_name
                - file_path
                - is_active
                - parse_status
                - download_url
                - created_at
                - updated_at
              properties:
                id:
                  type: string
                  format: uuid
                file_name:
                  type: string
                file_path:
                  type: string
                is_active:
                  type: boolean
                parse_status:
                  type: string
                  enum: [pending, completed, failed]
                parsed_data:
                  $ref: '#/components/schemas/ParsedResumeData'
                download_url:
                  type: string
                  format: uri
                  description: Signed URL for PDF download (expires in 1 hour)
                created_at:
                  type: string
                  format: date-time
                updated_at:
                  type: string
                  format: date-time

    ResumeUploadResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                resume:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    user_id:
                      type: string
                      format: uuid
                    file_name:
                      type: string
                    file_path:
                      type: string
                    parsed_data:
                      $ref: '#/components/schemas/ParsedResumeData'
                    parse_status:
                      type: string
                      enum: [pending, completed, failed]
                    created_at:
                      type: string
                      format: date-time
                    updated_at:
                      type: string
                      format: date-time
                ai_provider_used:
                  type: string
                  nullable: true
                  example: claude

    SetActiveResumeResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                message:
                  type: string
                  example: Resume set as active
                active_resume_id:
                  type: string
                  format: uuid

    ResumeDeleteResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                message:
                  type: string
                  example: Resume deleted successfully

    JobStatus:
      type: string
      enum:
        - saved
        - applied
        - interviewing
        - offered
        - rejected
        - accepted
      description: Job application status

    JobCreateRequest:
      type: object
      required:
        - title
        - company
        - description
      properties:
        title:
          type: string
          example: Senior Software Engineer
        company:
          type: string
          example: Acme Corp
        description:
          type: string
          example: We are looking for a senior engineer...
        location:
          type: string
          nullable: true
          example: San Francisco, CA
        salary_range:
          type: string
          nullable: true
          example: $150k-$200k
        employment_type:
          type: string
          nullable: true
          example: Full-time
        source_url:
          type: string
          nullable: true
          format: uri
          example: https://acme.com/jobs/123
        status:
          $ref: '#/components/schemas/JobStatus'
          description: Optional status (defaults to "saved" if not provided)

    JobUpdateRequest:
      type: object
      properties:
        title:
          type: string
        company:
          type: string
        description:
          type: string
        location:
          type: string
          nullable: true
        salary_range:
          type: string
          nullable: true
        employment_type:
          type: string
          nullable: true
        source_url:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/JobStatus'
        notes:
          type: string
          nullable: true

    JobData:
      type: object
      required:
        - id
        - user_id
        - title
        - company
        - status
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        title:
          type: string
          example: Senior Software Engineer
        company:
          type: string
          example: Acme Corp
        description:
          type: string
          nullable: true
        location:
          type: string
          nullable: true
        salary_range:
          type: string
          nullable: true
        employment_type:
          type: string
          nullable: true
        source_url:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/JobStatus'
        notes:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    JobResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/JobData'

    JobListItem:
      type: object
      required:
        - id
        - title
        - company
        - status
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          example: Senior Software Engineer
        company:
          type: string
          example: Acme Corp
        status:
          $ref: '#/components/schemas/JobStatus'
        notes_preview:
          type: string
          nullable: true
          description: First 100 characters of notes (if any)
          example: "Recruiter mentioned..."
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    JobListResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              required:
                - items
                - total
                - page
                - page_size
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/JobListItem'
                total:
                  type: integer
                  description: Total number of matching jobs
                  example: 25
                page:
                  type: integer
                  description: Current page number
                  example: 1
                page_size:
                  type: integer
                  description: Items per page
                  example: 20

    JobStatusUpdateRequest:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/JobStatus'

    JobNotesUpdateRequest:
      type: object
      required:
        - notes
      properties:
        notes:
          type: string
          description: Notes content to save
          example: "Recruiter mentioned team is scaling. Follow up next week."

    JobDeleteResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                message:
                  type: string
                  example: Job deleted successfully

    MatchAnalysisRequest:
      type: object
      required:
        - job_id
      properties:
        job_id:
          type: string
          format: uuid
          description: UUID of the job to analyze
        resume_id:
          type: string
          format: uuid
          nullable: true
          description: UUID of specific resume to use. If not provided, uses active resume.
        ai_provider:
          type: string
          enum:
            - claude
            - gpt
          nullable: true
          description: AI provider to use. Overrides user preference.

    MatchAnalysisData:
      type: object
      required:
        - match_score
        - strengths
        - gaps
        - recommendations
        - ai_provider_used
      properties:
        match_score:
          type: integer
          minimum: 0
          maximum: 100
          description: Match score from 0-100
          example: 78
        strengths:
          type: array
          items:
            type: string
          description: List of matching qualifications (3-5 items)
          example:
            - "5+ years Python experience matches requirement"
            - "FastAPI experience directly applicable"
        gaps:
          type: array
          items:
            type: string
          description: List of missing requirements (2-4 items)
          example:
            - "Job requires Kubernetes experience - not mentioned in resume"
        recommendations:
          type: array
          items:
            type: string
          description: Actionable suggestions (2-3 items)
          example:
            - "Highlight Docker experience as transferable to Kubernetes"
        ai_provider_used:
          type: string
          enum:
            - claude
            - gpt
          description: The AI provider that generated this analysis

    MatchAnalysisResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/MatchAnalysisData'

    CoverLetterRequest:
      type: object
      required:
        - job_id
      properties:
        job_id:
          type: string
          format: uuid
          description: UUID of the job to generate cover letter for
        resume_id:
          type: string
          format: uuid
          nullable: true
          description: UUID of specific resume to use. If not provided, uses active resume.
        tone:
          type: string
          enum:
            - confident
            - friendly
            - enthusiastic
            - professional
            - executive
          default: professional
          description: Tone for the cover letter
        custom_instructions:
          type: string
          maxLength: 500
          nullable: true
          description: Optional user instructions (max 500 characters)
        feedback:
          type: string
          maxLength: 2000
          nullable: true
          description: Feedback for regeneration (requires previous_content)
        previous_content:
          type: string
          maxLength: 5000
          nullable: true
          description: Previous cover letter content (required when feedback is provided)
        ai_provider:
          type: string
          enum:
            - claude
            - gpt
          nullable: true
          description: AI provider to use. Overrides user preference.

    CoverLetterData:
      type: object
      required:
        - content
        - ai_provider_used
        - tokens_used
      properties:
        content:
          type: string
          description: Generated cover letter text
          example: "Dear Hiring Manager,\n\nI am writing to express my strong interest in the Senior Python Developer position..."
        ai_provider_used:
          type: string
          enum:
            - claude
            - gpt
          description: The AI provider that generated this cover letter
        tokens_used:
          type: integer
          description: Approximate tokens used in generation
          example: 1250

    CoverLetterResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/CoverLetterData'

    CoverLetterPDFRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          minLength: 1
          description: Cover letter content to convert to PDF
        file_name:
          type: string
          nullable: true
          description: Optional filename for the PDF (will be sanitized). Defaults to "cover_letter"

    AnswerRequest:
      type: object
      required:
        - job_id
        - question
      properties:
        job_id:
          type: string
          format: uuid
          description: UUID of the job to generate answer for
        resume_id:
          type: string
          format: uuid
          nullable: true
          description: UUID of specific resume to use. If not provided, uses active resume.
        question:
          type: string
          minLength: 1
          maxLength: 2000
          description: The application question to answer
        max_length:
          type: integer
          enum:
            - 150
            - 300
            - 500
            - 1000
          default: 500
          description: Target character length for the answer
        feedback:
          type: string
          maxLength: 2000
          nullable: true
          description: Feedback for regeneration (requires previous_content)
        previous_content:
          type: string
          maxLength: 5000
          nullable: true
          description: Previous answer content (required when feedback is provided)
        ai_provider:
          type: string
          enum:
            - claude
            - gpt
          nullable: true
          description: AI provider to use. Overrides user preference.

    AnswerData:
      type: object
      required:
        - content
        - ai_provider_used
        - tokens_used
      properties:
        content:
          type: string
          description: Generated answer text
          example: "I am drawn to Acme Corp's mission to revolutionize the industry through innovative technology..."
        ai_provider_used:
          type: string
          enum:
            - claude
            - gpt
          description: The AI provider that generated this answer
        tokens_used:
          type: integer
          description: Approximate tokens used in generation
          example: 450

    AnswerResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/AnswerData'

    OutreachRequest:
      type: object
      required:
        - job_id
        - recipient_type
        - platform
      properties:
        job_id:
          type: string
          format: uuid
          description: UUID of the job to generate outreach for
        resume_id:
          type: string
          format: uuid
          nullable: true
          description: UUID of specific resume to use. If not provided, uses active resume.
        recipient_type:
          type: string
          enum:
            - recruiter
            - hiring_manager
            - referral
          description: Type of recipient for the outreach message
        platform:
          type: string
          enum:
            - linkedin
            - email
            - twitter
          description: Target platform for the outreach message
        recipient_name:
          type: string
          maxLength: 100
          nullable: true
          description: Recipient's name for personalized greeting (if not provided, no greeting is used)
        feedback:
          type: string
          maxLength: 2000
          nullable: true
          description: Feedback for regeneration (requires previous_content)
        previous_content:
          type: string
          maxLength: 5000
          nullable: true
          description: Previous message content (required when feedback is provided)
        ai_provider:
          type: string
          enum:
            - claude
            - gpt
          nullable: true
          description: AI provider to use. Overrides user preference.

    OutreachData:
      type: object
      required:
        - content
        - ai_provider_used
        - tokens_used
      properties:
        content:
          type: string
          description: Generated outreach message text
          example: "Hi Sarah,\n\nI came across the Senior Engineer role at Acme Corp..."
        ai_provider_used:
          type: string
          enum:
            - claude
            - gpt
          description: The AI provider that generated this message
        tokens_used:
          type: integer
          description: Approximate tokens used in generation
          example: 380

    OutreachResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/OutreachData'

    PersonalData:
      type: object
      description: Personal data extracted from resume and profile for autofill
      properties:
        first_name:
          type: string
          nullable: true
          example: "John"
        last_name:
          type: string
          nullable: true
          example: "Doe"
        full_name:
          type: string
          nullable: true
          description: Computed from first_name + last_name
          example: "John Doe"
        email:
          type: string
          format: email
          nullable: true
          example: "john@example.com"
        phone:
          type: string
          nullable: true
          example: "+1-555-0100"
        location:
          type: string
          nullable: true
          example: "San Francisco, CA"
        linkedin_url:
          type: string
          format: uri
          nullable: true
          example: "https://linkedin.com/in/johndoe"
        portfolio_url:
          type: string
          format: uri
          nullable: true
          description: Currently not populated (future feature)

    AutofillResumeData:
      type: object
      description: Resume data for autofill including signed download URL
      required:
        - id
        - file_name
        - download_url
      properties:
        id:
          type: string
          format: uuid
        file_name:
          type: string
          example: "john_doe_resume.pdf"
        download_url:
          type: string
          format: uri
          description: Signed URL for resume download (expires in 1 hour)
        parsed_summary:
          type: string
          nullable: true
          description: First 200 characters of parsed resume summary
          example: "Senior software engineer with 8 years of experience..."

    AutofillData:
      type: object
      required:
        - personal
      properties:
        personal:
          $ref: '#/components/schemas/PersonalData'
        resume:
          allOf:
            - $ref: '#/components/schemas/AutofillResumeData'
          nullable: true
          description: Resume data if user has an active resume, null otherwise
        work_authorization:
          type: string
          nullable: true
          description: Future feature placeholder (currently null)
        salary_expectation:
          type: string
          nullable: true
          description: Future feature placeholder (currently null)

    AutofillDataResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/AutofillData'

    CheckoutRequest:
      type: object
      required:
        - tier
        - success_url
        - cancel_url
      properties:
        tier:
          type: string
          enum: [starter, pro, power]
          description: "Subscription tier to upgrade to"
        success_url:
          type: string
          format: uri
          description: "URL to redirect on successful checkout"
        cancel_url:
          type: string
          format: uri
          description: "URL to redirect on canceled checkout"

    CheckoutResponseData:
      type: object
      properties:
        checkout_url:
          type: string
          format: uri
          description: "Checkout URL (real or mock)"
        mock:
          type: boolean
          description: "Whether this is a mock response"

    CheckoutResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/CheckoutResponseData'

    PortalResponseData:
      type: object
      properties:
        portal_url:
          type: string
          format: uri
          description: "Portal URL (real or mock)"
        mock:
          type: boolean
          description: "Whether this is a mock response"

    PortalResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/PortalResponseData'

    UsageByType:
      type: object
      description: Breakdown of credits used by operation type
      properties:
        match:
          type: integer
          example: 2
        cover_letter:
          type: integer
          example: 5
        answer:
          type: integer
          example: 1
        outreach:
          type: integer
          example: 3
        resume_parse:
          type: integer
          example: 1
        referral_bonus:
          type: integer
          description: Credits added via referrals (negative value)
          example: -5

    UsageBalanceData:
      type: object
      required:
        - subscription_tier
        - period_type
        - period_key
        - credits_used
        - credits_limit
        - credits_remaining
        - usage_by_type
        - subscription_status
      properties:
        subscription_tier:
          type: string
          enum: [free, pro, unlimited]
          example: "free"
        period_type:
          type: string
          enum: [lifetime, monthly]
          example: "lifetime"
        period_key:
          type: string
          description: Period identifier (e.g., "lifetime" or "2026-02")
          example: "lifetime"
        credits_used:
          type: integer
          description: Total credits consumed in current period
          example: 3
        credits_limit:
          type: integer
          description: Credit limit for current tier (-1 means unlimited)
          example: 5
        credits_remaining:
          type: integer
          description: Credits remaining in current period (-1 means unlimited)
          example: 2
        usage_by_type:
          $ref: '#/components/schemas/UsageByType'
        subscription_status:
          type: string
          enum: [active, canceled, past_due]
          description: Current subscription status
          example: "active"
        current_period_end:
          type: string
          format: date-time
          nullable: true
          description: End of current billing period (monthly tiers only, null for lifetime)
        pending_deletion_expires:
          type: string
          format: date-time
          nullable: true
          description: If account deletion is pending, when the deletion token expires

    UsageBalanceResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/UsageBalanceData'

    UsageEventItem:
      type: object
      required:
        - id
        - operation_type
        - credits_used
        - period_type
        - period_key
        - created_at
      properties:
        id:
          type: string
          format: uuid
        operation_type:
          type: string
          enum: [match, cover_letter, answer, outreach, resume_parse, referral_bonus]
        ai_provider:
          type: string
          nullable: true
          description: AI provider used (null for referral_bonus)
        credits_used:
          type: integer
          description: Credits consumed (negative for referral bonus)
        period_type:
          type: string
          enum: [lifetime, monthly]
        period_key:
          type: string
        created_at:
          type: string
          format: date-time

    UsageHistoryData:
      type: object
      required:
        - items
        - total
        - page
        - page_size
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/UsageEventItem'
        total:
          type: integer
          description: Total number of usage events
        page:
          type: integer
          description: Current page number
        page_size:
          type: integer
          description: Items per page

    UsageHistoryResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/UsageHistoryData'

    # ============================================================================
    # Privacy Schemas
    # ============================================================================

    ProfileStorageInfo:
      type: object
      required:
        - stored
        - fields
        - location
      properties:
        stored:
          type: boolean
          description: Whether profile data is stored
        fields:
          type: array
          items:
            type: string
          description: List of stored profile fields
        location:
          type: string
          description: Storage location description

    ResumeStorageInfo:
      type: object
      required:
        - count
        - max_resumes
        - at_limit
        - storage
        - includes
      properties:
        count:
          type: integer
          description: Number of resumes stored
        max_resumes:
          type: integer
          description: Maximum allowed resumes
        at_limit:
          type: boolean
          description: Whether user has reached resume limit
        storage:
          type: string
          description: Storage location description
        includes:
          type: array
          items:
            type: string
          description: Types of data included

    JobStatusBreakdown:
      type: object
      properties:
        saved:
          type: integer
        applied:
          type: integer
        interviewing:
          type: integer
        offered:
          type: integer
        rejected:
          type: integer
        accepted:
          type: integer

    JobStorageInfo:
      type: object
      required:
        - count
        - storage
        - status_breakdown
      properties:
        count:
          type: integer
          description: Total number of jobs
        storage:
          type: string
          description: Storage location description
        status_breakdown:
          $ref: '#/components/schemas/JobStatusBreakdown'

    UsageOperationBreakdown:
      type: object
      properties:
        match:
          type: integer
        cover_letter:
          type: integer
        answer:
          type: integer
        outreach:
          type: integer
        resume_parse:
          type: integer

    UsageHistoryStorageInfo:
      type: object
      required:
        - count
        - storage
        - includes
        - breakdown
      properties:
        count:
          type: integer
          description: Total usage events
        storage:
          type: string
          description: Storage location description
        includes:
          type: array
          items:
            type: string
          description: Types of data tracked
        breakdown:
          $ref: '#/components/schemas/UsageOperationBreakdown'

    AIGeneratedContentInfo:
      type: object
      required:
        - stored
        - note
      properties:
        stored:
          type: boolean
          description: Whether AI content is stored (always false)
        note:
          type: string
          description: Explanation of storage policy

    DataSummaryData:
      type: object
      required:
        - profile
        - resumes
        - jobs
        - usage_history
        - ai_generated_content
        - data_retention
        - export_available
        - export_note
      properties:
        profile:
          $ref: '#/components/schemas/ProfileStorageInfo'
        resumes:
          $ref: '#/components/schemas/ResumeStorageInfo'
        jobs:
          $ref: '#/components/schemas/JobStorageInfo'
        usage_history:
          $ref: '#/components/schemas/UsageHistoryStorageInfo'
        ai_generated_content:
          $ref: '#/components/schemas/AIGeneratedContentInfo'
        data_retention:
          type: string
          description: Data retention policy
        export_available:
          type: boolean
          description: Whether data export is available
        export_note:
          type: string
          description: Note about data export feature

    DataSummaryResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/DataSummaryData'

    DeleteRequestRequest:
      type: object
      properties:
        reason:
          type: string
          enum: [no_longer_needed, switching_service, privacy_concerns, too_expensive, not_useful, other]
          description: Optional reason for deletion (product feedback)

    DeleteRequestData:
      type: object
      required:
        - message
        - email_sent_to
        - expires_in
        - deletion_initiated_at
      properties:
        message:
          type: string
          description: Confirmation message
        email_sent_to:
          type: string
          description: Masked email address where token was sent
        expires_in:
          type: string
          description: Token expiry duration
        deletion_initiated_at:
          type: string
          format: date-time
          description: When deletion was requested

    DeleteRequestResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/DeleteRequestData'

    ConfirmDeleteRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          minLength: 32
          description: Deletion confirmation token from email

    ConfirmDeleteData:
      type: object
      required:
        - message
        - deleted_at
      properties:
        message:
          type: string
          description: Confirmation message
        deleted_at:
          type: string
          format: date-time
          description: When account was deleted

    ConfirmDeleteResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/ConfirmDeleteData'

    CancelDeleteData:
      type: object
      required:
        - message
        - cancelled_at
      properties:
        message:
          type: string
          description: Confirmation message
        cancelled_at:
          type: string
          format: date-time
          description: When deletion was cancelled

    CancelDeleteResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/CancelDeleteData'

    # Feedback Schemas
    FeedbackCategory:
      type: string
      enum:
        - bug
        - feature_request
        - general
        - praise
        - complaint
      description: Feedback category type

    FeedbackRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          minLength: 10
          maxLength: 5000
          description: Feedback content (10-5000 characters)
        category:
          $ref: '#/components/schemas/FeedbackCategory'
          default: general
        context:
          type: object
          additionalProperties: true
          description: Optional context (page_url, feature_used, browser, extension_version)
          example:
            page_url: "https://linkedin.com/jobs/123"
            feature_used: "cover_letter"
            browser: "Chrome 120"

    FeedbackSubmitResponse:
      type: object
      required:
        - message
        - feedback_id
      properties:
        message:
          type: string
          example: "Thank you for your feedback!"
        feedback_id:
          type: string
          format: uuid
          description: Unique identifier for the submitted feedback

    FeedbackSubmitResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/FeedbackSubmitResponse'
